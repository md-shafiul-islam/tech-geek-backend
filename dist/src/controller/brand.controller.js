"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.brandController = void 0;
const writeLog_1 = require("../logger/writeLog");
const brand_service_1 = require("../service/brand.service");
const product_service_1 = require("../service/product.service");
const respFormat_1 = __importDefault(require("../utils/response/respFormat"));
class BrandController {
    async getByBrandName(req, resp) {
        try {
            const name = req?.params?.name;
            const brand = await brand_service_1.brandService.getBrandByName(name);
            if (brand) {
                resp.status(200);
                resp.send((0, respFormat_1.default)(brand, "Brand Found", true));
            }
            else {
                resp.status(202);
                resp.send((0, respFormat_1.default)(brand, "Brand not Found by given id", true));
            }
        }
        catch (error) { }
    }
    async getAllProductsByBrand(req, resp) {
        writeLog_1.apiWriteLog.info("getAllProductsByBrand ", req.query);
        const products = await product_service_1.productService.getAllProductBrand(req.query);
        if (products) {
            resp.status(200);
            resp.send((0, respFormat_1.default)(products, `${products?.length} Products By Brand found`, true));
        }
        else {
            resp.status(200);
            resp.send((0, respFormat_1.default)(null, "Product not found by Brand"));
        }
    }
    async getAll(req, resp) {
        writeLog_1.apiWriteLog.info("Test writ file", { test: "Object is write" });
        const brands = await brand_service_1.brandService.getAllBrand();
        if (brands) {
            resp.status(200);
            resp.send((0, respFormat_1.default)(brands, "Brand found", true));
        }
        else {
            resp.status(200);
            resp.send((0, respFormat_1.default)(brands, "Brand not found"));
        }
    }
    async getById(req, resp) {
        const id = parseInt(req?.params?.id);
        const brand = await brand_service_1.brandService.getBrandById(id);
        if (brand) {
            resp.status(200);
            resp.send((0, respFormat_1.default)(brand, "Brand Found", true));
        }
        else {
            resp.status(202);
            resp.send((0, respFormat_1.default)(brand, "Brand not Found by given id", true));
        }
    }
    async add(req, resp) {
        console.log("Brand Add Request Body ", req.body);
        const brandReq = req.body;
        console.log("After Partial Brand Add Request Body ", brandReq);
        const { name, description, tagLine, logoUrl, website } = req.body;
        try {
            const nBrand = await brand_service_1.brandService.save({
                name,
                description,
                tagLine,
                logoUrl,
                website,
            });
            console.log("Brand added Response ", nBrand);
            resp.status(201);
            resp.send((0, respFormat_1.default)(nBrand, "Brand Save Or Added", true));
        }
        catch (error) {
            resp.status(202);
            resp.send((0, respFormat_1.default)(null, "Brand Added failed", false));
        }
    }
    async update(req, resp) {
        const { id, name, description, tagLine, logoUrl, website, publicId } = req.body;
        const brand = {
            id,
            publicId,
            name,
            description,
            tagLine,
            logoUrl,
            website,
            products: [],
            news: [],
        };
        const updateBrand = await brand_service_1.brandService.updateBrand(brand);
        if (updateBrand !== undefined && updateBrand !== null) {
            resp.status(202);
            resp.send((0, respFormat_1.default)(updateBrand, "Brand updated", true));
        }
        else {
            resp.status(202);
            resp.send((0, respFormat_1.default)(null, "Brand update failed", false));
        }
    }
    async delete(req, resp) {
        const { id } = req.params;
        const intId = parseInt(id);
        if (intId > 0) {
            const deleteResp = await brand_service_1.brandService.deleteBrand(intId);
            if (deleteResp) {
                resp.status(202);
                resp.send((0, respFormat_1.default)(deleteResp, "Brand deleted ", true));
            }
        }
        resp.status(202);
        resp.send((0, respFormat_1.default)(null, "Brand delete failed", false));
    }
}
exports.brandController = new BrandController();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJhbmQuY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cm9sbGVyL2JyYW5kLmNvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsaURBQWlEO0FBRWpELDREQUF3RDtBQUN4RCxnRUFBNEQ7QUFFNUQsOEVBQXNEO0FBRXRELE1BQU0sZUFBZTtJQUNuQixLQUFLLENBQUMsY0FBYyxDQUFDLEdBQVksRUFBRSxJQUFjO1FBQy9DLElBQUk7WUFDRixNQUFNLElBQUksR0FBRyxHQUFHLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQztZQUMvQixNQUFNLEtBQUssR0FBRyxNQUFNLDRCQUFZLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXRELElBQUksS0FBSyxFQUFFO2dCQUNULElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBQSxvQkFBVSxFQUFDLEtBQUssRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNuRDtpQkFBTTtnQkFDTCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUEsb0JBQVUsRUFBQyxLQUFLLEVBQUUsNkJBQTZCLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQzthQUNuRTtTQUNGO1FBQUMsT0FBTyxLQUFLLEVBQUUsR0FBRTtJQUNwQixDQUFDO0lBRUQsS0FBSyxDQUFDLHFCQUFxQixDQUFDLEdBQVksRUFBRSxJQUFjO1FBQ3RELHNCQUFXLENBQUMsSUFBSSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0RCxNQUFNLFFBQVEsR0FBRyxNQUFNLGdDQUFjLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BFLElBQUksUUFB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LEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7UUFDMUIsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTNCLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTtZQUNiLE1BQU0sVUFBVSxHQUFHLE1BQU0sNEJBQVksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFekQsSUFBSSxVQUFVLEVBQUU7Z0JBQ2QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFBLG9CQUFVLEVBQUMsVUFBVSxFQUFFLGdCQUFnQixFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7YUFDM0Q7U0FDRjtRQUNELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFBLG9CQUFVLEVBQUMsSUFBSSxFQUFFLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDNUQsQ0FBQztDQUNGO0FBRVksUUFBQSxlQUFlLEdBQUcsSUFBSSxlQUFlLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSBcImV4cHJlc3NcIjtcclxuaW1wb3J0IHsgYXBpV3JpdGVMb2cgfSBmcm9tIFwiLi4vbG9nZ2VyL3dyaXRlTG9nXCI7XHJcbmltcG9ydCB7IEJyYW5kIH0gZnJvbSBcIi4uL21vZGVsL0JyYW5kXCI7XHJcbmltcG9ydCB7IGJyYW5kU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlL2JyYW5kLnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgcHJvZHVjdFNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZS9wcm9kdWN0LnNlcnZpY2VcIjtcclxuaW1wb3J0IHsgZXNJc0VtcHR5IH0gZnJvbSBcIi4uL3V0aWxzL2VzSGVscGVyXCI7XHJcbmltcG9ydCByZXNwRm9ybWF0IGZyb20gXCIuLi91dGlscy9yZXNwb25zZS9yZXNwRm9ybWF0XCI7XHJcblxyXG5jbGFzcyBCcmFuZENvbnRyb2xsZXIge1xyXG4gIGFzeW5jIGdldEJ5QnJhbmROYW1lKHJlcTogUmVxdWVzdCwgcmVzcDogUmVzcG9uc2UpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG5hbWUgPSByZXE/LnBhcmFtcz8ubmFtZTtcclxuICAgICAgY29uc3QgYnJhbmQgPSBhd2FpdCBicmFuZFNlcnZpY2UuZ2V0QnJhbmRCeU5hbWUobmFtZSk7XHJcblxyXG4gICAgICBpZiAoYnJhbmQpIHtcclxuICAgICAgICByZXNwLnN0YXR1cygyMDApO1xyXG4gICAgICAgIHJlc3Auc2VuZChyZXNwRm9ybWF0KGJyYW5kLCBcIkJyYW5kIEZvdW5kXCIsIHRydWUpKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXNwLnN0YXR1cygyMDIpO1xyXG4gICAgICAgIHJlc3Auc2VuZChyZXNwRm9ybWF0KGJyYW5kLCBcIkJyYW5kIG5vdCBGb3VuZCBieSBnaXZlbiBpZFwiLCB0cnVlKSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0QWxsUHJvZHVjdHNCeUJyYW5kKHJlcTogUmVxdWVzdCwgcmVzcDogUmVzcG9uc2UpIHtcclxuICAgIGFwaVdyaXRlTG9nLmluZm8oXCJnZXRBbGxQcm9kdWN0c0J5QnJhbmQgXCIsIHJlcS5xdWVyeSk7XHJcbiAgICBjb25zdCBwcm9kdWN0cyA9IGF3YWl0IHByb2R1Y3RTZXJ2aWNlLmdldEFsbFByb2R1Y3RCcmFuZChyZXEucXVlcnkpO1xyXG4gICAgaWYgKHByb2R1Y3RzKSB7XHJcbiAgICAgIHJlc3Auc3RhdHVzKDIwMCk7XHJcbiAgICAgIHJlc3Auc2VuZChcclxuICAgICAgICByZXNwRm9ybWF0KFxyXG4gICAgICAgICAgcHJvZHVjdHMsXHJcbiAgICAgICAgICBgJHtwcm9kdWN0cz8ubGVuZ3RofSBQcm9kdWN0cyBCeSBCcmFuZCBmb3VuZGAsXHJcbiAgICAgICAgICB0cnVlXHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzcC5zdGF0dXMoMjAwKTtcclxuICAgICAgcmVzcC5zZW5kKHJlc3BGb3JtYXQobnVsbCwgXCJQcm9kdWN0IG5vdCBmb3VuZCBieSBCcmFuZFwiKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRBbGwocmVxOiBSZXF1ZXN0LCByZXNwOiBSZXNwb25zZSkge1xyXG4gICAgYXBpV3JpdGVMb2cuaW5mbyhcIlRlc3Qgd3JpdCBmaWxlXCIsIHsgdGVzdDogXCJPYmplY3QgaXMgd3JpdGVcIiB9KTtcclxuICAgIGNvbnN0IGJyYW5kcyA9IGF3YWl0IGJyYW5kU2VydmljZS5nZXRBbGxCcmFuZCgpO1xyXG4gICAgaWYgKGJyYW5kcykge1xyXG4gICAgICByZXNwLnN0YXR1cygyMDApO1xyXG4gICAgICByZXNwLnNlbmQocmVzcEZvcm1hdChicmFuZHMsIFwiQnJhbmQgZm91bmRcIiwgdHJ1ZSkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzcC5zdGF0dXMoMjAwKTtcclxuICAgICAgcmVzcC5zZW5kKHJlc3BGb3JtYXQoYnJhbmRzLCBcIkJyYW5kIG5vdCBmb3VuZFwiKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRCeUlkKHJlcTogUmVxdWVzdCwgcmVzcDogUmVzcG9uc2UpIHtcclxuICAgIGNvbnN0IGlkID0gcGFyc2VJbnQocmVxPy5wYXJhbXM/LmlkKTtcclxuICAgIGNvbnN0IGJyYW5kID0gYXdhaXQgYnJhbmRTZXJ2aWNlLmdldEJyYW5kQnlJZChpZCk7XHJcblxyXG4gICAgaWYgKGJyYW5kKSB7XHJcbiAgICAgIHJlc3Auc3RhdHVzKDIwMCk7XHJcbiAgICAgIHJlc3Auc2VuZChyZXNwRm9ybWF0KGJyYW5kLCBcIkJyYW5kIEZvdW5kXCIsIHRydWUpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc3Auc3RhdHVzKDIwMik7XHJcbiAgICAgIHJlc3Auc2VuZChyZXNwRm9ybWF0KGJyYW5kLCBcIkJyYW5kIG5vdCBGb3VuZCBieSBnaXZlbiBpZFwiLCB0cnVlKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBhZGQocmVxOiBSZXF1ZXN0LCByZXNwOiBSZXNwb25zZSkge1xyXG4gICAgY29uc29sZS5sb2coXCJCcmFuZCBBZGQgUmVxdWVzdCBCb2R5IFwiLCByZXEuYm9keSk7XHJcblxyXG4gICAgY29uc3QgYnJhbmRSZXE6IFBhcnRpYWw8QnJhbmQ+ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJBZnRlciBQYXJ0aWFsIEJyYW5kIEFkZCBSZXF1ZXN0IEJvZHkgXCIsIGJyYW5kUmVxKTtcclxuXHJcbiAgICBjb25zdCB7IG5hbWUsIGRlc2NyaXB0aW9uLCB0YWdMaW5lLCBsb2dvVXJsLCB3ZWJzaXRlIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBuQnJhbmQgPSBhd2FpdCBicmFuZFNlcnZpY2Uuc2F2ZSh7XHJcbiAgICAgICAgbmFtZSxcclxuICAgICAgICBkZXNjcmlwdGlvbixcclxuICAgICAgICB0YWdMaW5lLFxyXG4gICAgICAgIGxvZ29VcmwsXHJcbiAgICAgICAgd2Vic2l0ZSxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBjb25zb2xlLmxvZyhcIkJyYW5kIGFkZGVkIFJlc3BvbnNlIFwiLCBuQnJhbmQpO1xyXG5cclxuICAgICAgcmVzcC5zdGF0dXMoMjAxKTtcclxuICAgICAgcmVzcC5zZW5kKHJlc3BGb3JtYXQobkJyYW5kLCBcIkJyYW5kIFNhdmUgT3IgQWRkZWRcIiwgdHJ1ZSkpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmVzcC5zdGF0dXMoMjAyKTtcclxuICAgICAgcmVzcC5zZW5kKHJlc3BGb3JtYXQobnVsbCwgXCJCcmFuZCBBZGRlZCBmYWlsZWRcIiwgZmFsc2UpKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGFzeW5jIHVwZGF0ZShyZXE6IFJlcXVlc3QsIHJlc3A6IFJlc3BvbnNlKSB7XHJcbiAgICBjb25zdCB7IGlkLCBuYW1lLCBkZXNjcmlwdGlvbiwgdGFnTGluZSwgbG9nb1VybCwgd2Vic2l0ZSwgcHVibGljSWQgfSA9XHJcbiAgICAgIHJlcS5ib2R5O1xyXG4gICAgY29uc3QgYnJhbmQ6IEJyYW5kID0ge1xyXG4gICAgICBpZCxcclxuICAgICAgcHVibGljSWQsXHJcbiAgICAgIG5hbWUsXHJcbiAgICAgIGRlc2NyaXB0aW9uLFxyXG4gICAgICB0YWdMaW5lLFxyXG4gICAgICBsb2dvVXJsLFxyXG4gICAgICB3ZWJzaXRlLFxyXG4gICAgICBwcm9kdWN0czogW10sXHJcbiAgICAgIG5ld3M6IFtdLFxyXG4gICAgfTtcclxuICAgIGNvbnN0IHVwZGF0ZUJyYW5kID0gYXdhaXQgYnJhbmRTZXJ2aWNlLnVwZGF0ZUJyYW5kKGJyYW5kKTtcclxuXHJcbiAgICBpZiAodXBkYXRlQnJhbmQgIT09IHVuZGVmaW5lZCAmJiB1cGRhdGVCcmFuZCAhPT0gbnVsbCkge1xyXG4gICAgICByZXNwLnN0YXR1cygyMDIpO1xyXG4gICAgICByZXNwLnNlbmQocmVzcEZvcm1hdCh1cGRhdGVCcmFuZCwgXCJCcmFuZCB1cGRhdGVkXCIsIHRydWUpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc3Auc3RhdHVzKDIwMik7XHJcbiAgICAgIHJlc3Auc2VuZChyZXNwRm9ybWF0KG51bGwsIFwiQnJhbmQgdXBkYXRlIGZhaWxlZFwiLCBmYWxzZSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGVsZXRlKHJlcTogUmVxdWVzdCwgcmVzcDogUmVzcG9uc2UpIHtcclxuICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICBjb25zdCBpbnRJZCA9IHBhcnNlSW50KGlkKTtcclxuXHJcbiAgICBpZiAoaW50SWQgPiAwKSB7XHJcbiAgICAgIGNvbnN0IGRlbGV0ZVJlc3AgPSBhd2FpdCBicmFuZFNlcnZpY2UuZGVsZXRlQnJhbmQoaW50SWQpO1xyXG5cclxuICAgICAgaWYgKGRlbGV0ZVJlc3ApIHtcclxuICAgICAgICByZXNwLnN0YXR1cygyMDIpO1xyXG4gICAgICAgIHJlc3Auc2VuZChyZXNwRm9ybWF0KGRlbGV0ZVJlc3AsIFwiQnJhbmQgZGVsZXRlZCBcIiwgdHJ1ZSkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXNwLnN0YXR1cygyMDIpO1xyXG4gICAgcmVzcC5zZW5kKHJlc3BGb3JtYXQobnVsbCwgXCJCcmFuZCBkZWxldGUgZmFpbGVkXCIsIGZhbHNlKSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgYnJhbmRDb250cm9sbGVyID0gbmV3IEJyYW5kQ29udHJvbGxlcigpO1xyXG4iXX0=